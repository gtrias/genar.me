---
// CRT Effects Overlay Component
// Adds all the CRT visual effects to the page
---

<!-- CRT Screen Effects -->
<div class="crt-curve" id="crt-curve"></div>
<div class="crt-noise" id="crt-noise"></div>

<script>
  // Mobile detection and performance optimization
  document.addEventListener('DOMContentLoaded', async () => {
    const { defaultDeviceConfig } = await import('../terminal/config/DeviceConfig');
    const { StyleManager } = await import('../terminal/effects');
    
    const isMobile = defaultDeviceConfig.mobileRegex.test(navigator.userAgent);
    const isLowPerformance = navigator.hardwareConcurrency && navigator.hardwareConcurrency <= 2;
    
    if (isMobile || isLowPerformance) {
      // Reduce effects on mobile or low-performance devices
      const styleManager = new StyleManager(
        await import('../terminal/config/ThemeConfig').then(m => m.defaultThemeConfig),
        defaultDeviceConfig
      );
      styleManager.applyMobileOptimizations();
    }
    
    // Add rare random glitches to the entire page
    if (!isMobile) {
      startPageGlitches();
    }
  });
  
  function startPageGlitches() {
    setInterval(() => {
      if (Math.random() < 0.01) { // 1% chance every interval
        const body = document.body;
        body.classList.add('random-glitch');
        setTimeout(() => {
          body.classList.remove('random-glitch');
        }, 200);
      }
    }, 5000); // Check every 5 seconds
  }
</script>

<!-- SVG filter for chromatic aberration -->
<svg style="position: absolute; width: 0; height: 0;">
	<defs>
		<filter id="chromatic-aberration">
			<feColorMatrix type="matrix" values="1 0 0 0 0
													0 1 0 0 0
													0 0 1 0 0
													0 0 0 1 0" result="original"/>
			<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
			<feColorMatrix in="blur" type="matrix" values="1 0 0 0 0
															0 0 0 0 0
															0 0 0 0 0
															0 0 0 0.5 0" result="red"/>
			<feColorMatrix in="blur" type="matrix" values="0 0 0 0 0
															0 1 0 0 0
															0 0 0 0 0
															0 0 0 0.5 0" result="green"/>
			<feColorMatrix in="blur" type="matrix" values="0 0 0 0 0
															0 0 0 0 0
															0 0 1 0 0
															0 0 0 0.5 0" result="blue"/>
			<feOffset in="red" dx="1" dy="0" result="red-offset"/>
			<feOffset in="green" dx="0" dy="0" result="green-offset"/>
			<feOffset in="blue" dx="-1" dy="0" result="blue-offset"/>
			<feBlend in="red-offset" in2="green-offset" mode="screen" result="rg"/>
			<feBlend in="rg" in2="blue-offset" mode="screen" result="rgb"/>
			<feBlend in="original" in2="rgb" mode="multiply"/>
		</filter>
	</defs>
</svg>